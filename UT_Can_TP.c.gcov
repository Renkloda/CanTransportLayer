        -:    0:Source:UT_Can_TP.c
        -:    0:Graph:.\UT_Can_TP.gcno
        -:    0:Data:.\UT_Can_TP.gcda
        -:    0:Runs:16
        -:    1:#include "acutest.h"
        -:    2:#include "Std_Types.h"
        -:    3:
        -:    4:#include "CanTp.c"   
        -:    5:
        -:    6:#include <stdio.h>
        -:    7:#include <string.h>
        -:    8:
        -:    9:#include "fff.h"
        -:   10:
        -:   11:DEFINE_FFF_GLOBALS; 
        -:   12:
       6*:   13:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyTxData, PduIdType, const PduInfoType*, const RetryInfoType*, PduLengthType*);
------------------
PduR_CanTpCopyTxData_reset:
        2:   13:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyTxData, PduIdType, const PduInfoType*, const RetryInfoType*, PduLengthType*);
------------------
PduR_CanTpCopyTxData:
       4*:   13:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyTxData, PduIdType, const PduInfoType*, const RetryInfoType*, PduLengthType*);
------------------
      11*:   14:FAKE_VOID_FUNC(PduR_CanTpTxConfirmation, PduIdType, Std_ReturnType);
------------------
PduR_CanTpTxConfirmation_reset:
        4:   14:FAKE_VOID_FUNC(PduR_CanTpTxConfirmation, PduIdType, Std_ReturnType);
------------------
PduR_CanTpTxConfirmation:
       7*:   14:FAKE_VOID_FUNC(PduR_CanTpTxConfirmation, PduIdType, Std_ReturnType);
------------------
      11*:   15:FAKE_VOID_FUNC(PduR_CanTpRxIndication, PduIdType, Std_ReturnType);
------------------
PduR_CanTpRxIndication_reset:
        4:   15:FAKE_VOID_FUNC(PduR_CanTpRxIndication, PduIdType, Std_ReturnType);
------------------
PduR_CanTpRxIndication:
       7*:   15:FAKE_VOID_FUNC(PduR_CanTpRxIndication, PduIdType, Std_ReturnType);
------------------
    #####:   16:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyRxData, PduIdType, const PduInfoType*, PduLengthType*);
------------------
PduR_CanTpCopyRxData_reset:
    #####:   16:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyRxData, PduIdType, const PduInfoType*, PduLengthType*);
------------------
PduR_CanTpCopyRxData:
    #####:   16:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyRxData, PduIdType, const PduInfoType*, PduLengthType*);
------------------
    #####:   17:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpStartOfReception, PduIdType, const PduInfoType*, PduLengthType, PduLengthType*);
------------------
PduR_CanTpStartOfReception_reset:
    #####:   17:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpStartOfReception, PduIdType, const PduInfoType*, PduLengthType, PduLengthType*);
------------------
PduR_CanTpStartOfReception:
    #####:   17:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpStartOfReception, PduIdType, const PduInfoType*, PduLengthType, PduLengthType*);
------------------
        -:   18:
    #####:   19:FAKE_VALUE_FUNC(Std_ReturnType, CanIf_Transmit, PduIdType, const PduInfoType*);
------------------
CanIf_Transmit_reset:
    #####:   19:FAKE_VALUE_FUNC(Std_ReturnType, CanIf_Transmit, PduIdType, const PduInfoType*);
------------------
CanIf_Transmit:
    #####:   19:FAKE_VALUE_FUNC(Std_ReturnType, CanIf_Transmit, PduIdType, const PduInfoType*);
------------------
        -:   20:
        -:   21:
       3*:   22:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendSF, PduIdType, uint8*, PduLengthType);
------------------
CanTp_SendSF_reset:
        1:   22:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendSF, PduIdType, uint8*, PduLengthType);
------------------
CanTp_SendSF:
       2*:   22:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendSF, PduIdType, uint8*, PduLengthType);
------------------
       3*:   23:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendFF, PduIdType, PduLengthType);
------------------
CanTp_SendFF_reset:
        1:   23:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendFF, PduIdType, PduLengthType);
------------------
CanTp_SendFF:
       2*:   23:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendFF, PduIdType, PduLengthType);
------------------
       2*:   24:FAKE_VOID_FUNC(CanTp_SendNextCF);
------------------
CanTp_SendNextCF_reset:
        1:   24:FAKE_VOID_FUNC(CanTp_SendNextCF);
------------------
CanTp_SendNextCF:
       1*:   24:FAKE_VOID_FUNC(CanTp_SendNextCF);
------------------
       3*:   25:FAKE_VOID_FUNC(CanTp_FFReception, PduIdType, const PduInfoType*, CanPCI_Type*);
------------------
CanTp_FFReception_reset:
        1:   25:FAKE_VOID_FUNC(CanTp_FFReception, PduIdType, const PduInfoType*, CanPCI_Type*);
------------------
CanTp_FFReception:
       2*:   25:FAKE_VOID_FUNC(CanTp_FFReception, PduIdType, const PduInfoType*, CanPCI_Type*);
------------------
       3*:   26:FAKE_VOID_FUNC(CanTp_SFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
CanTp_SFReception_reset:
        1:   26:FAKE_VOID_FUNC(CanTp_SFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
CanTp_SFReception:
       2*:   26:FAKE_VOID_FUNC(CanTp_SFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
       2*:   27:FAKE_VOID_FUNC(CanTp_CFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
CanTp_CFReception_reset:
        1:   27:FAKE_VOID_FUNC(CanTp_CFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
CanTp_CFReception:
       1*:   27:FAKE_VOID_FUNC(CanTp_CFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
       3*:   28:FAKE_VOID_FUNC(CanTp_FCReception, PduIdType, CanPCI_Type*);
------------------
CanTp_FCReception_reset:
        1:   28:FAKE_VOID_FUNC(CanTp_FCReception, PduIdType, CanPCI_Type*);
------------------
CanTp_FCReception:
       2*:   28:FAKE_VOID_FUNC(CanTp_FCReception, PduIdType, CanPCI_Type*);
------------------
        -:   29:
        -:   30:uint8 PduR_CanTpCopyTxData_sdu_data[20][7];
        -:   31:PduLengthType *PduR_CanTpCopyTxData_availableDataPtr; 
        -:   32:PduLengthType* PduR_CanTpCopyRxData_buffSize_array;
        -:   33:PduLengthType *PduR_CanTpStartOfReception_buffSize_array;
        -:   34:
        -:   35:
    #####:   36:BufReq_ReturnType PduR_CanTpCopyTxData_FF(PduIdType id, const PduInfoType* info, const RetryInfoType* retry, PduLengthType* availableDataPtr){
        -:   37:    static int i = 0;
        -:   38:    int iCtr;
    #####:   39:    i = PduR_CanTpCopyTxData_fake.call_count - 1;
    #####:   40:    for(iCtr = 0; iCtr < info->SduLength; iCtr++ ){
    #####:   41:      info->SduDataPtr[iCtr] = PduR_CanTpCopyTxData_sdu_data[i][iCtr];
        -:   42:    }
    #####:   43:    *availableDataPtr = PduR_CanTpCopyTxData_availableDataPtr[i];
    #####:   44:    return PduR_CanTpCopyTxData_fake.return_val_seq[i];
        -:   45:}
        -:   46:
    #####:   47:BufReq_ReturnType PduR_CanTpStartOfReception_FF(PduIdType id, const PduInfoType* info, PduLengthType TpSduLength, PduLengthType* bufferSizePtr){
        -:   48:    static int i = 0;
    #####:   49:    i = PduR_CanTpStartOfReception_fake.call_count - 1;
    #####:   50:    *bufferSizePtr = PduR_CanTpStartOfReception_buffSize_array[i];
    #####:   51:   return PduR_CanTpStartOfReception_fake.return_val_seq[i];
        -:   52:}
        -:   53:
    #####:   54:BufReq_ReturnType PduR_CanTpCopyRxData_FF(PduIdType id, const PduInfoType* info, PduLengthType* bufferSizePtr){
        -:   55:    static int i = 0;
    #####:   56:    i = PduR_CanTpCopyRxData_fake.call_count - 1;
    #####:   57:    *bufferSizePtr = PduR_CanTpCopyRxData_buffSize_array[i];
    #####:   58:    return PduR_CanTpCopyRxData_fake.return_val_seq[i];
        -:   59:}
        -:   60:
        -:   61:
        -:   62:/** ==================================================================================================================*\
        -:   63:                                TESTY JEDNOSTKOWE
        -:   64:\*====================================================================================================================*/
        -:   65:
        -:   66:
        1:   67:void Test_Of_CanTp_Init(void){
        -:   68:	//TEST1
        1:   69:    CanTp_ConfigType config = {
        -:   70:        .CanTpMainFunctionPeriod = 0.01,
        -:   71:        .CanTpMaxChannelCnt = 1,
        -:   72:        .pChannel = 0
        -:   73:    };
        -:   74:
        1:   75:    CanTpInit(&config);
        -:   76:    
        1:   77:    TEST_CHECK(CanTpState == CANTP_ON);
        -:   78:	//TEST2
        1:   79:	CanTpInit(NULL);
        1:   80:    TEST_CHECK(CanTpState == CANTP_ON);  // Stan siÄ™ nie zmienia
        1:   81:}
        -:   82:
        -:   83:
        1:   84:void Test_Of_CanTp_GetVersionInfo(void)
        -:   85:{
        -:   86:    Std_VersionInfoType versionInfo;
        -:   87:
        -:   88:    // TEST1
        1:   89:    CanTp_GetVersionInfo(&versionInfo);
        -:   90:
        1:   91:    TEST_CHECK(versionInfo.vendorID == 0x00u);
        1:   92:    TEST_CHECK(versionInfo.moduleID == CANTP_MODULE_ID);
        1:   93:    TEST_CHECK(versionInfo.sw_major_version == CANTP_SW_MAJOR_VERSION);
        1:   94:    TEST_CHECK(versionInfo.sw_minor_version == CANTP_SW_MINOR_VERSION);
        1:   95:    TEST_CHECK(versionInfo.sw_patch_version == CANTP_SW_PATCH_VERSION);
        -:   96:
        -:   97:    // TEST2
        1:   98:    CanTp_GetVersionInfo(NULL);
        -:   99:      
        1:  100:}
        -:  101:
        -:  102:
        1:  103:void Test_Of_CanTp_Shutdown(void){
        -:  104:
        1:  105:    CanTpState = CANTP_ON;
        -:  106:
        1:  107:    CanTp_Shutdown();
        -:  108:
        1:  109:    TEST_CHECK(CanTpState == CANTP_OFF);
        1:  110:    TEST_CHECK(CanTpState != CANTP_ON);
        -:  111:	
        -:  112:	//TEST2
        1:  113:	  CanTp_Shutdown();
        1:  114:    TEST_CHECK(CanTpState == CANTP_OFF);
        1:  115:}
        -:  116:
        -:  117:
        1:  118:void TestOf_CanTp_Transmit(void){
        -:  119:
        1:  120:    PduIdType txPduId = 0x01;
        1:  121:    uint8 sduData[8] = {0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88};
        1:  122:    uint8 metaData[3] = {0x11, 0x22, 0x33};
        -:  123:
        1:  124:    PduInfoType pduInfo = {
        -:  125:        .SduDataPtr = sduData,
        -:  126:        .SduLength = 6,
        -:  127:        .MetaDataPtr = metaData
        -:  128:    };
        -:  129:
        1:  130:    RESET_FAKE(PduR_CanTpCopyTxData);
        1:  131:    RESET_FAKE(CanTp_SendSF);
        1:  132:    RESET_FAKE(PduR_CanTpTxConfirmation);
        1:  133:    RESET_FAKE(CanTp_SendFF);
        -:  134:
        1:  135:    BufReq_ReturnType retPduR_CanTpCopyTxData[7] = {BUFREQ_OK, BUFREQ_E_NOT_OK, BUFREQ_E_OVFL, E_OK, E_NOT_OK, E_NOT_OK, E_NOT_OK};
        1:  136:    SET_RETURN_SEQ(PduR_CanTpCopyTxData, retPduR_CanTpCopyTxData, 7);
        -:  137:
        1:  138:    Std_ReturnType retCanTp_SendSF[7] = {E_OK, E_OK, E_NOT_OK, E_OK, E_NOT_OK, E_NOT_OK, E_NOT_OK};
        1:  139:    SET_RETURN_SEQ(CanTp_SendSF, retCanTp_SendSF, 7);
        1:  140:    Std_ReturnType retCanTp_SendFF[7] = {E_OK, E_NOT_OK, E_NOT_OK, E_OK, E_NOT_OK, E_NOT_OK, E_NOT_OK};
        1:  141:    SET_RETURN_SEQ(CanTp_SendFF, retCanTp_SendFF, 7);
        -:  142:
        -:  143:    // TEST1: 
        1:  144:    CanTpState = CANTP_OFF;
        1:  145:    Std_ReturnType ret = CanTp_Transmit(txPduId, &pduInfo);
        1:  146:    TEST_CHECK(ret == E_NOT_OK);
        -:  147:
        -:  148:
        -:  149:
        -:  150:    // TEST2:
        -:  151:
        1:  152:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_EXTENDED;
        1:  153:    CanTpState = CANTP_ON;
        1:  154:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        1:  155:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  156:
        1:  157:    TEST_CHECK(ret == E_OK);
        1:  158:    TEST_CHECK(p_n_sdu.tx.taskState == CANTP_TX_WAIT);
        1:  159:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        1:  160:    TEST_CHECK(p_n_sdu.tx.saved_n_ta.CanTpNTa == 0x11);
        -:  161:
        1:  162:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 1);
        1:  163:    TEST_CHECK(CanTp_SendSF_fake.call_count == 1);
        -:  164:
        -:  165:  //TEST3
        -:  166:
        1:  167:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED;
        1:  168:    CanTpState = CANTP_ON;
        1:  169:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        1:  170:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  171:
        1:  172:    TEST_CHECK(ret == E_NOT_OK);
        1:  173:    TEST_CHECK(CanTp_ConfigPtr.pChannel.tx.CanTpTX_state == CANTP_TX_WAIT);
        1:  174:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        1:  175:    TEST_CHECK(p_n_sdu.tx.saved_n_ae.CanTpNAe == 0x11);
        1:  176:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 2);
        -:  177:
        1:  178:    TEST_CHECK(PduR_CanTpTxConfirmation_fake.call_count == 1);
        1:  179:    TEST_CHECK(CanTp_SendSF_fake.call_count == 1);
        -:  180:
        -:  181:  //TEST4
        -:  182:
        1:  183:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_NORMALFIXED;
        1:  184:    CanTpState = CANTP_ON;
        1:  185:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        1:  186:    pduInfo.SduLength = 8;
        1:  187:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  188:
        1:  189:    TEST_CHECK(ret == E_OK);
        1:  190:    TEST_CHECK(CanTp_ConfigPtr.pChannel.tx.CanTpTX_state == CANTP_TX_WAIT);
        1:  191:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        1:  192:    TEST_CHECK(p_n_sdu.tx.saved_n_sa.CanTpNSa == 0x11);
        1:  193:    TEST_CHECK(p_n_sdu.tx.saved_n_ta.CanTpNTa == 0x22);
        -:  194:
        1:  195:    TEST_CHECK(CanTp_SendFF_fake.call_count == 1);
        -:  196:	
        -:  197:    //TEST5
        -:  198:
        1:  199:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED29BIT;
        1:  200:    CanTpState = CANTP_ON;
        1:  201:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        1:  202:    pduInfo.SduLength = 8;
        1:  203:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  204:
        1:  205:    TEST_CHECK(ret == E_NOT_OK);
        1:  206:    TEST_CHECK(CanTp_ConfigPtr.pChannel.tx.CanTpTX_state == CANTP_TX_WAIT);
        1:  207:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        1:  208:    TEST_CHECK(p_n_sdu.tx.saved_n_sa.CanTpNSa == 0x11);
        1:  209:    TEST_CHECK(p_n_sdu.tx.saved_n_ta.CanTpNTa == 0x22);
        1:  210:    TEST_CHECK(p_n_sdu.tx.saved_n_ae.CanTpNAe == 0x33);
        -:  211:
        1:  212:    TEST_CHECK(CanTp_SendFF_fake.call_count == 2);
        -:  213:
        -:  214:    //TEST6
        -:  215:
        1:  216:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED29BIT;
        1:  217:    CanTpState = CANTP_ON;
        1:  218:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        1:  219:    pduInfo.SduLength = 3;
        1:  220:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  221:
        1:  222:    TEST_CHECK(ret == E_OK);
        1:  223:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        1:  224:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 3);
        -:  225:
        -:  226:
        -:  227:    //TEST7
        -:  228:
        1:  229:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED29BIT;
        1:  230:    CanTpState = CANTP_ON;
        1:  231:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        1:  232:    pduInfo.MetaDataPtr = NULL;
        1:  233:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  234:
        1:  235:    TEST_CHECK(ret == E_OK);
        1:  236:    TEST_CHECK(p_n_sdu.tx.has_meta_data == FALSE);
        1:  237:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 4);
        -:  238:
        -:  239:     //TEST7
        -:  240:
        1:  241:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED29BIT;
        1:  242:    CanTpState = CANTP_ON;
        1:  243:    p_n_sdu.tx.taskState = CANTP_TX_PROCESSING;
        1:  244:    pduInfo.MetaDataPtr = NULL;
        1:  245:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  246:
        1:  247:    TEST_CHECK(ret == E_NOT_OK);
        1:  248:    TEST_CHECK(p_n_sdu.tx.has_meta_data == FALSE);
        1:  249:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 4);
        -:  250:
        -:  251:
        -:  252:  
        1:  253:}
        -:  254:
        -:  255:
        1:  256:void Test_Of_CanTp_CancelTransmit(void){
        -:  257:
        1:  258:    PduIdType txPduId = 1;
        -:  259:
        1:  260:    CanTp_ConfigPtr.pChannel.tx.CanTpTxNSduId = 2;
        -:  261:
        1:  262:    Std_ReturnType ret = CanTp_CancelTransmit(txPduId);
        1:  263:    TEST_CHECK(ret == E_NOT_OK);
        -:  264:
        1:  265:    CanTp_ConfigPtr.pChannel.tx.CanTpTxNSduId = txPduId;
        1:  266:    ret = CanTp_CancelTransmit(txPduId);
        1:  267:    TEST_CHECK(ret == E_OK);
        -:  268:
        1:  269:}
        -:  270:
        -:  271:
        1:  272:void Test_Of_CanTp_CancelReceive(void){
        1:  273:    PduIdType rxPduId = 0x01;
        -:  274:
        1:  275:    CanTp_ConfigPtr.pChannel.rx.CanTpRxNSduId = 2;
        -:  276:
        1:  277:    Std_ReturnType ret = CanTp_CancelReceive(rxPduId);
        1:  278:    TEST_CHECK(ret == E_NOT_OK);
        -:  279:
        1:  280:    CanTp_ConfigPtr.pChannel.rx.CanTpRxNSduId = rxPduId;
        1:  281:    ret = CanTp_CancelReceive(rxPduId);
        1:  282:    TEST_CHECK(ret == E_OK);
        1:  283:}
        -:  284:
        -:  285:
        -:  286:
        1:  287:void Test_Of_CanTp_ChangeParameter(void){
        1:  288:    PduIdType id = 0x01;
        1:  289:    CanTpGeneralgPtr.CanTpChangeParameterApi = 1; 
        -:  290:
        1:  291:    CanTpState = CANTP_ON;
        1:  292:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_WAIT;
        1:  293:    TPParameterType Parameter_Test = TP_BS;
        1:  294:    uint16 value = 10;
        -:  295:
        1:  296:    Std_ReturnType ret = CanTp_ChangeParameter(id, Parameter_Test, value);
        1:  297:    TEST_CHECK(ret == E_OK);
        1:  298:    TEST_CHECK(p_n_sdu.rx.shared_params.params.bs == 10);
        -:  299:
        1:  300:    ret = CanTp_ChangeParameter(id, TP_STMIN, 20);
        1:  301:    TEST_CHECK(ret == E_OK);
        1:  302:    TEST_CHECK(p_n_sdu.rx.shared_params.params.st_min == 20);
        -:  303:
        1:  304:    ret = CanTp_ChangeParameter(id, TP_BC, 30);
        1:  305:    TEST_CHECK(ret == E_NOT_OK);
        -:  306:
        1:  307:    CanTpState = CANTP_OFF;
        1:  308:    ret = CanTp_ChangeParameter(id, TP_BS, 40);
        1:  309:    TEST_CHECK(ret == E_NOT_OK);
        -:  310:
        1:  311:    CanTpState = CANTP_ON;
        1:  312:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_PROCESSING; 
        1:  313:    ret = CanTp_ChangeParameter(id, TP_BS, 40);
        1:  314:    TEST_CHECK(ret == E_NOT_OK);
        -:  315:
        1:  316:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_WAIT; 
        1:  317:    CanTpState = CANTP_ON;
        1:  318:    CanTpGeneralgPtr.CanTpChangeParameterApi = 0; 
        1:  319:    ret = CanTp_ChangeParameter(id, TP_BS, 40);
        1:  320:    TEST_CHECK(ret == E_NOT_OK);
        -:  321:
        -:  322:    
        1:  323:}
        -:  324:
        -:  325:
        1:  326:void Test_Of_CanTp_ReadParameter(void){
        1:  327:    PduIdType id = 1;
        -:  328:    uint16 value;
        -:  329:
        1:  330:    CanTpState = CANTP_ON;
        1:  331:    p_n_sdu.rx.shared_params.params.bs = 15;
        1:  332:    CanTpGeneralgPtr.CanTpReadParameterApi  = 1;
        -:  333:
        1:  334:    Std_ReturnType ret = CanTp_ReadParameter(id, TP_BS, &value);
        1:  335:    TEST_CHECK(ret == E_OK);
        1:  336:    TEST_CHECK(value == 15);
        -:  337:
        -:  338:    
        1:  339:    p_n_sdu.rx.shared_params.params.st_min = 25;
        1:  340:    ret = CanTp_ReadParameter(id, TP_STMIN, &value);
        1:  341:    TEST_CHECK(ret == E_OK);
        1:  342:    TEST_CHECK(value == 25);
        -:  343:
        1:  344:    ret = CanTp_ReadParameter(id, TP_BC, &value);
        1:  345:    TEST_CHECK(ret == E_NOT_OK);
        -:  346:
        1:  347:    CanTpState = CANTP_OFF;
        1:  348:    ret = CanTp_ReadParameter(id, TP_BS, &value);
        1:  349:    TEST_CHECK(ret == E_NOT_OK);
        -:  350:
        1:  351:    CanTpState = CANTP_ON;
        1:  352:    CanTpGeneralgPtr.CanTpReadParameterApi  = 0; 
        1:  353:    ret = CanTp_ReadParameter(id, TP_BS, &value);
        1:  354:    TEST_CHECK(ret == E_NOT_OK);
        1:  355:}
        -:  356:
        1:  357:void Test_Of_CanTp_MainFunction(){
        -:  358:
        1:  359:    RESET_FAKE(PduR_CanTpRxIndication);
        1:  360:    RESET_FAKE(PduR_CanTpTxConfirmation);
        -:  361:
        -:  362:
        1:  363:    CanTp_TimerReset(&N_Ar_timer);
        1:  364:    CanTp_MainFunction();
        1:  365:    TEST_CHECK(N_Ar_timer.uiCounter == 0);
        -:  366:
        1:  367:    CanTp_TimerStart(&N_Ar_timer);
        1:  368:    CanTp_MainFunction();
        1:  369:    TEST_CHECK(N_Ar_timer.uiCounter == 1);
        -:  370:
        1:  371:    N_Ar_timer.uiCounter = 999;
        1:  372:    CanTp_MainFunction();
        1:  373:    TEST_CHECK(N_Ar_timer.uiCounter == 0);
        -:  374:
        1:  375:    N_As_timer.uiCounter = 990;
        1:  376:    CanTp_TimerStart(&N_As_timer);
        1:  377:    CanTp_MainFunction();
        -:  378:
        1:  379:    TEST_CHECK(N_As_timer.uiCounter == 991);
        1:  380:    TEST_CHECK(N_As_timer.eState == TIMER_ENABLE);
        1:  381:    TEST_CHECK(N_Bs_timer.uiCounter == 0);
        1:  382:    TEST_CHECK(N_Bs_timer.eState == TIMER_DISABLE);
        1:  383:    TEST_CHECK(N_Cs_timer.uiCounter == 0);
        1:  384:    TEST_CHECK(N_Cs_timer.eState == TIMER_DISABLE);
        -:  385:
        1:  386:    TEST_CHECK(PduR_CanTpTxConfirmation_fake.call_count == 0);
        -:  387:    
        -:  388:
        1:  389:    CanTp_TimerStart(&N_As_timer);
        1:  390:    CanTp_TimerStart(&N_Bs_timer);
        1:  391:    CanTp_TimerStart(&N_Cs_timer);
        -:  392:
        1:  393:    CanTp_TimerStart(&N_Ar_timer);
        1:  394:    CanTp_TimerStart(&N_Br_timer);
        1:  395:    CanTp_TimerStart(&N_Cr_timer);
        -:  396:
        1:  397:    N_As_timer.uiCounter = 999;
        1:  398:    N_Bs_timer.uiCounter = 999;
        1:  399:    N_Cs_timer.uiCounter = 999;
        1:  400:    N_Ar_timer.uiCounter = 999;
        1:  401:    N_Br_timer.uiCounter = 999;
        1:  402:    N_Cr_timer.uiCounter = 999;
        1:  403:    RESET_FAKE(PduR_CanTpTxConfirmation);
        1:  404:    RESET_FAKE(PduR_CanTpRxIndication);
        1:  405:    CanTp_MainFunction();
        -:  406:  
        1:  407:    TEST_CHECK(N_As_timer.uiCounter == 0);
        1:  408:    TEST_CHECK(N_As_timer.eState == TIMER_DISABLE);
        1:  409:    TEST_CHECK(N_Bs_timer.uiCounter == 0);
        1:  410:    TEST_CHECK(N_Bs_timer.eState == TIMER_DISABLE);
        1:  411:    TEST_CHECK(N_Cs_timer.uiCounter == 0);
        1:  412:    TEST_CHECK(N_Cs_timer.eState == TIMER_DISABLE);
        -:  413:
        1:  414:    TEST_CHECK(N_Ar_timer.uiCounter == 0);
        1:  415:    TEST_CHECK(N_Ar_timer.eState == TIMER_DISABLE);
        1:  416:    TEST_CHECK(N_Br_timer.uiCounter == 0);
        1:  417:    TEST_CHECK(N_Br_timer.eState == TIMER_DISABLE);
        1:  418:    TEST_CHECK(N_Cr_timer.uiCounter == 0);
        1:  419:    TEST_CHECK(N_Cr_timer.eState == TIMER_DISABLE);
        -:  420:
        1:  421:    TEST_CHECK(PduR_CanTpTxConfirmation_fake.call_count == 3);
        1:  422:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 3);
        -:  423:
        1:  424:}
        -:  425:
        -:  426:
        1:  427:void Test_CanTp_RxIndication(void) {
        1:  428:    PduIdType rxPduId = 1;
        1:  429:    CanTpState = CANTP_ON;
        -:  430:
        -:  431:    PduInfoType testPduInfo;
        1:  432:    uint8 testSduData[8] = {SF<<4, 0, 0, 0, 0, 0, 0, 0};
        1:  433:    testPduInfo.SduDataPtr = testSduData;
        -:  434:
        1:  435:    RESET_FAKE(CanTp_FFReception);
        1:  436:    RESET_FAKE(CanTp_SFReception);
        1:  437:    RESET_FAKE(CanTp_FCReception);
        1:  438:    RESET_FAKE(CanTp_CFReception);
        1:  439:    RESET_FAKE(PduR_CanTpRxIndication);
        -:  440:
        -:  441:   
        1:  442:    CanTpState = CANTP_ON;
        1:  443:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_WAIT;
        -:  444:
        1:  445:    CanTp_RxIndication(rxPduId, &testPduInfo);
        1:  446:    TEST_CHECK(CanTp_SFReception_fake.call_count == 1);
        -:  447:
        1:  448:    testSduData[0] = FF<<4;
        1:  449:    testPduInfo.SduDataPtr = testSduData;
        -:  450:
        1:  451:    CanTp_RxIndication(rxPduId, &testPduInfo);
        1:  452:    TEST_CHECK(CanTp_FFReception_fake.call_count == 1);
        -:  453:
        1:  454:    testSduData[0] = FC<<4;
        1:  455:    testPduInfo.SduDataPtr = testSduData;
        -:  456:
        1:  457:    CanTp_RxIndication(rxPduId, &testPduInfo);
        1:  458:    TEST_CHECK(CanTp_FCReception_fake.call_count == 1);
        -:  459:
        1:  460:    testSduData[0] = CF<<4;
        1:  461:    testPduInfo.SduDataPtr = testSduData;
        -:  462:
        1:  463:    CanTp_RxIndication(rxPduId, &testPduInfo);
        1:  464:    TEST_CHECK(CanTp_SFReception_fake.call_count == 1);
        1:  465:    TEST_CHECK(CanTp_FFReception_fake.call_count == 1);
        1:  466:    TEST_CHECK(CanTp_FCReception_fake.call_count == 1);
        -:  467:
        1:  468:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_PROCESSING;
        -:  469:
        1:  470:    testSduData[0] = CF<<4;
        1:  471:    testPduInfo.SduDataPtr = testSduData;
        -:  472:
        1:  473:    CanTp_RxIndication(rxPduId, &testPduInfo);
        1:  474:    TEST_CHECK(CanTp_CFReception_fake.call_count == 1);
        -:  475:
        1:  476:    testSduData[0] = FC<<4;
        1:  477:    testPduInfo.SduDataPtr = testSduData;
        -:  478:
        1:  479:    CanTp_RxIndication(rxPduId, &testPduInfo);
        1:  480:    TEST_CHECK(CanTp_FCReception_fake.call_count == 2);
        -:  481:
        1:  482:    testSduData[0] = FF<<4;
        1:  483:    testPduInfo.SduDataPtr = testSduData;
        -:  484:
        1:  485:    CanTp_RxIndication(rxPduId, &testPduInfo);
        1:  486:    TEST_CHECK(CanTp_FFReception_fake.call_count == 2);
        1:  487:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 1);
        1:  488:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        -:  489:
        1:  490:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_PROCESSING;
        -:  491:
        1:  492:    testSduData[0] = SF<<4;
        1:  493:    testPduInfo.SduDataPtr = testSduData;
        -:  494:
        1:  495:    CanTp_RxIndication(rxPduId, &testPduInfo);
        1:  496:    TEST_CHECK(CanTp_SFReception_fake.call_count == 2);
        1:  497:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 2);
        1:  498:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        -:  499:
        1:  500:}
        -:  501:
        -:  502:
        1:  503:void Test_Of_CanTp_TxConfirmation(void){
        -:  504:
        1:  505:  RESET_FAKE(PduR_CanTpCopyTxData);
        1:  506:  RESET_FAKE(CanTp_SendNextCF);
        1:  507:  RESET_FAKE(PduR_CanTpTxConfirmation);
        1:  508:  RESET_FAKE(PduR_CanTpRxIndication);
        -:  509:
        -:  510:    
        1:  511:    CanTpState = CANTP_ON;
        1:  512:    CanTp_ConfigPtr.pChannel.rx.CanTpRxNSduId = 2;
        1:  513:    CanTp_ConfigPtr.pChannel.rx.CanTpRX_state = CANTP_RX_PROCESSING;
        1:  514:    CanTp_ConfigPtr.pChannel.tx.CanTpTxNSduId = 1;
        1:  515:    CanTp_ConfigPtr.pChannel.tx.CanTpTX_state = CANTP_TX_PROCESSING;
        -:  516:
        1:  517:    CanTp_TxConfirmation(2, E_NOT_OK);
        1:  518:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        1:  519:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 1 );
        -:  520:
        -:  521:    
        1:  522:    CanTp_TxConfirmation(2, E_OK);
        1:  523:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        1:  524:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 1 );
        -:  525:
        1:  526:    CanTp_TxConfirmation(1, E_OK);
        1:  527:    TEST_CHECK(CanTp_SendNextCF_fake.call_count == 1 );
        -:  528:
        1:  529:    CanTp_TxConfirmation(1, E_NOT_OK);
        1:  530:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        1:  531:    TEST_CHECK(PduR_CanTpTxConfirmation_fake.call_count == 1);
        -:  532:
        -:  533:
        1:  534:}
        -:  535:
        -:  536:/** ==================================================================================================================*\
        -:  537:                                TESTY FUNKCJI POMOCNICZYCH
        -:  538:\*====================================================================================================================*/
        -:  539:
        1:  540:void Test_CanTp_TimerStart(void) {
        1:  541:    CanTp_Timer_type timer = {TIMER_DISABLE, 0, 100};
        -:  542:
        1:  543:    CanTp_TimerStart(&timer);
        1:  544:    TEST_CHECK(timer.eState == TIMER_ENABLE);
        1:  545:    TEST_CHECK(timer.uiCounter == 0);
        -:  546:
        1:  547:    timer.eState = TIMER_ENABLE;
        1:  548:    CanTp_TimerStart(&timer);
        1:  549:    TEST_CHECK(timer.eState == TIMER_ENABLE);
        1:  550:    TEST_CHECK(timer.uiCounter == 0);
        1:  551:}
        -:  552:
        1:  553:void Test_Of_TimerReset(void){     
        1:  554:    CanTp_Timer_type timer = {TIMER_ENABLE, 50, 100};
        -:  555:
        1:  556:    CanTp_TimerReset(&timer);
        1:  557:    TEST_CHECK(timer.eState == TIMER_DISABLE);
        1:  558:    TEST_CHECK(timer.uiCounter == 0);
        -:  559:
        1:  560:    CanTp_TimerReset(&timer);
        1:  561:    TEST_CHECK(timer.eState == TIMER_DISABLE);
        1:  562:    TEST_CHECK(timer.uiCounter == 0);
        1:  563:}
        -:  564:
        -:  565:
        1:  566:void Test_CanTp_TimerTick(void) {
        1:  567:    CanTp_Timer_type timer = {TIMER_ENABLE, 0, 100};
        -:  568:
        1:  569:    Std_ReturnType ret = CanTp_TimerTick(&timer);
        1:  570:    TEST_CHECK(ret == E_OK);
        1:  571:    TEST_CHECK(timer.uiCounter == 1);
        -:  572:
        1:  573:    timer.uiCounter = UINT32_MAX;
        1:  574:    ret = CanTp_TimerTick(&timer);
        1:  575:    TEST_CHECK(ret == E_NOT_OK);
        1:  576:    TEST_CHECK(timer.uiCounter == UINT32_MAX);
        -:  577:
        1:  578:    timer.eState = TIMER_DISABLE;
        1:  579:    ret = CanTp_TimerTick(&timer);
        1:  580:    TEST_CHECK(ret == E_OK);
        1:  581:    TEST_CHECK(timer.uiCounter == UINT32_MAX);  
        1:  582:}
        -:  583:
        1:  584:void Test_CanTp_TimerTimeout(void) {
        1:  585:    CanTp_Timer_type timer = {TIMER_ENABLE, 100, 100};
        -:  586:
        1:  587:    Std_ReturnType ret = CanTp_TimerTimeout(&timer);
        1:  588:    TEST_CHECK(ret == E_NOT_OK);
        -:  589:
        1:  590:    timer.uiCounter = 50;
        1:  591:    ret = CanTp_TimerTimeout(&timer);
        1:  592:    TEST_CHECK(ret == E_OK);
        1:  593:}
        -:  594:
        -:  595:
        -:  596:TEST_LIST = {
        -:  597:    { "Test of CanTp_MainFunction", Test_Of_CanTp_MainFunction },
        -:  598:    { "Test of CanTp_ReadParameter", Test_Of_CanTp_ReadParameter },
        -:  599:    { "Test of CanTp_ChangeParameter", Test_Of_CanTp_ChangeParameter },
        -:  600:	  { "Test of CanTp_TimerStart", Test_CanTp_TimerStart },
        -:  601:    { "Test of CanTp_TimerReset", Test_Of_TimerReset },
        -:  602:    { "Test of CanTp_TimerTick", Test_CanTp_TimerTick },
        -:  603:    { "Test of CanTp_TimerTimeout", Test_CanTp_TimerTimeout },
        -:  604:    { "Test of CanTp_RxIndication", Test_CanTp_RxIndication },
        -:  605:    { "Test of CanTp_TxConfirmation", Test_Of_CanTp_TxConfirmation },
        -:  606:    { "Test of CanTp_CancelReceive", Test_Of_CanTp_CancelReceive },
        -:  607:    { "Test of CanTp_CancelTransmit", Test_Of_CanTp_CancelTransmit },
        -:  608:    { "Test of CanTp_Transmit", TestOf_CanTp_Transmit },
        -:  609:    { "Test of CanTp_Init", Test_Of_CanTp_Init },
        -:  610:    { "Test of CanTp_Shutdown", Test_Of_CanTp_Shutdown },
        -:  611:	{ "Test of CanTp_GetVersionInfo", Test_Of_CanTp_GetVersionInfo },
        -:  612:    { NULL, NULL }                           
        -:  613:};
