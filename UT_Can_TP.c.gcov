        -:    0:Source:UT_Can_TP.c
        -:    0:Graph:.\UT_Can_TP.gcno
        -:    0:Data:.\UT_Can_TP.gcda
        -:    0:Runs:48
        -:    1:#include "acutest.h"
        -:    2:#include "Std_Types.h"
        -:    3:
        -:    4:#include "CanTp.c"   
        -:    5:
        -:    6:#include <stdio.h>
        -:    7:#include <string.h>
        -:    8:
        -:    9:#include "fff.h"
        -:   10:
        -:   11:DEFINE_FFF_GLOBALS; 
        -:   12:
      18*:   13:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyTxData, PduIdType, const PduInfoType*, const RetryInfoType*, PduLengthType*);
------------------
PduR_CanTpCopyTxData_reset:
        6:   13:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyTxData, PduIdType, const PduInfoType*, const RetryInfoType*, PduLengthType*);
------------------
PduR_CanTpCopyTxData:
      12*:   13:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyTxData, PduIdType, const PduInfoType*, const RetryInfoType*, PduLengthType*);
------------------
      33*:   14:FAKE_VOID_FUNC(PduR_CanTpTxConfirmation, PduIdType, Std_ReturnType);
------------------
PduR_CanTpTxConfirmation_reset:
       12:   14:FAKE_VOID_FUNC(PduR_CanTpTxConfirmation, PduIdType, Std_ReturnType);
------------------
PduR_CanTpTxConfirmation:
      21*:   14:FAKE_VOID_FUNC(PduR_CanTpTxConfirmation, PduIdType, Std_ReturnType);
------------------
      33*:   15:FAKE_VOID_FUNC(PduR_CanTpRxIndication, PduIdType, Std_ReturnType);
------------------
PduR_CanTpRxIndication_reset:
       12:   15:FAKE_VOID_FUNC(PduR_CanTpRxIndication, PduIdType, Std_ReturnType);
------------------
PduR_CanTpRxIndication:
      21*:   15:FAKE_VOID_FUNC(PduR_CanTpRxIndication, PduIdType, Std_ReturnType);
------------------
    #####:   16:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyRxData, PduIdType, const PduInfoType*, PduLengthType*);
------------------
PduR_CanTpCopyRxData_reset:
    #####:   16:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyRxData, PduIdType, const PduInfoType*, PduLengthType*);
------------------
PduR_CanTpCopyRxData:
    #####:   16:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpCopyRxData, PduIdType, const PduInfoType*, PduLengthType*);
------------------
    #####:   17:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpStartOfReception, PduIdType, const PduInfoType*, PduLengthType, PduLengthType*);
------------------
PduR_CanTpStartOfReception_reset:
    #####:   17:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpStartOfReception, PduIdType, const PduInfoType*, PduLengthType, PduLengthType*);
------------------
PduR_CanTpStartOfReception:
    #####:   17:FAKE_VALUE_FUNC(BufReq_ReturnType, PduR_CanTpStartOfReception, PduIdType, const PduInfoType*, PduLengthType, PduLengthType*);
------------------
        -:   18:
    #####:   19:FAKE_VALUE_FUNC(Std_ReturnType, CanIf_Transmit, PduIdType, const PduInfoType*);
------------------
CanIf_Transmit_reset:
    #####:   19:FAKE_VALUE_FUNC(Std_ReturnType, CanIf_Transmit, PduIdType, const PduInfoType*);
------------------
CanIf_Transmit:
    #####:   19:FAKE_VALUE_FUNC(Std_ReturnType, CanIf_Transmit, PduIdType, const PduInfoType*);
------------------
        -:   20:
        -:   21:
       9*:   22:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendSF, PduIdType, uint8*, PduLengthType);
------------------
CanTp_SendSF_reset:
        3:   22:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendSF, PduIdType, uint8*, PduLengthType);
------------------
CanTp_SendSF:
       6*:   22:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendSF, PduIdType, uint8*, PduLengthType);
------------------
       9*:   23:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendFF, PduIdType, PduLengthType);
------------------
CanTp_SendFF_reset:
        3:   23:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendFF, PduIdType, PduLengthType);
------------------
CanTp_SendFF:
       6*:   23:FAKE_VALUE_FUNC(Std_ReturnType, CanTp_SendFF, PduIdType, PduLengthType);
------------------
       6*:   24:FAKE_VOID_FUNC(CanTp_SendNextCF);
------------------
CanTp_SendNextCF_reset:
        3:   24:FAKE_VOID_FUNC(CanTp_SendNextCF);
------------------
CanTp_SendNextCF:
       3*:   24:FAKE_VOID_FUNC(CanTp_SendNextCF);
------------------
       9*:   25:FAKE_VOID_FUNC(CanTp_FFReception, PduIdType, const PduInfoType*, CanPCI_Type*);
------------------
CanTp_FFReception_reset:
        3:   25:FAKE_VOID_FUNC(CanTp_FFReception, PduIdType, const PduInfoType*, CanPCI_Type*);
------------------
CanTp_FFReception:
       6*:   25:FAKE_VOID_FUNC(CanTp_FFReception, PduIdType, const PduInfoType*, CanPCI_Type*);
------------------
       9*:   26:FAKE_VOID_FUNC(CanTp_SFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
CanTp_SFReception_reset:
        3:   26:FAKE_VOID_FUNC(CanTp_SFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
CanTp_SFReception:
       6*:   26:FAKE_VOID_FUNC(CanTp_SFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
       6*:   27:FAKE_VOID_FUNC(CanTp_CFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
CanTp_CFReception_reset:
        3:   27:FAKE_VOID_FUNC(CanTp_CFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
CanTp_CFReception:
       3*:   27:FAKE_VOID_FUNC(CanTp_CFReception, PduIdType, CanPCI_Type*, const PduInfoType*);
------------------
       9*:   28:FAKE_VOID_FUNC(CanTp_FCReception, PduIdType, CanPCI_Type*);
------------------
CanTp_FCReception_reset:
        3:   28:FAKE_VOID_FUNC(CanTp_FCReception, PduIdType, CanPCI_Type*);
------------------
CanTp_FCReception:
       6*:   28:FAKE_VOID_FUNC(CanTp_FCReception, PduIdType, CanPCI_Type*);
------------------
        -:   29:
        -:   30:uint8 PduR_CanTpCopyTxData_sdu_data[20][7];
        -:   31:PduLengthType *PduR_CanTpCopyTxData_availableDataPtr; 
        -:   32:PduLengthType* PduR_CanTpCopyRxData_buffSize_array;
        -:   33:PduLengthType *PduR_CanTpStartOfReception_buffSize_array;
        -:   34:
        -:   35:
    #####:   36:BufReq_ReturnType PduR_CanTpCopyTxData_FF(PduIdType id, const PduInfoType* info, const RetryInfoType* retry, PduLengthType* availableDataPtr){
        -:   37:    static int i = 0;
        -:   38:    int iCtr;
    #####:   39:    i = PduR_CanTpCopyTxData_fake.call_count - 1;
    #####:   40:    for(iCtr = 0; iCtr < info->SduLength; iCtr++ ){
    #####:   41:      info->SduDataPtr[iCtr] = PduR_CanTpCopyTxData_sdu_data[i][iCtr];
        -:   42:    }
    #####:   43:    *availableDataPtr = PduR_CanTpCopyTxData_availableDataPtr[i];
    #####:   44:    return PduR_CanTpCopyTxData_fake.return_val_seq[i];
        -:   45:}
        -:   46:
    #####:   47:BufReq_ReturnType PduR_CanTpStartOfReception_FF(PduIdType id, const PduInfoType* info, PduLengthType TpSduLength, PduLengthType* bufferSizePtr){
        -:   48:    static int i = 0;
    #####:   49:    i = PduR_CanTpStartOfReception_fake.call_count - 1;
    #####:   50:    *bufferSizePtr = PduR_CanTpStartOfReception_buffSize_array[i];
    #####:   51:   return PduR_CanTpStartOfReception_fake.return_val_seq[i];
        -:   52:}
        -:   53:
    #####:   54:BufReq_ReturnType PduR_CanTpCopyRxData_FF(PduIdType id, const PduInfoType* info, PduLengthType* bufferSizePtr){
        -:   55:    static int i = 0;
    #####:   56:    i = PduR_CanTpCopyRxData_fake.call_count - 1;
    #####:   57:    *bufferSizePtr = PduR_CanTpCopyRxData_buffSize_array[i];
    #####:   58:    return PduR_CanTpCopyRxData_fake.return_val_seq[i];
        -:   59:}
        -:   60:
        -:   61:
        -:   62:/** ==================================================================================================================*\
        -:   63:                                TESTY JEDNOSTKOWE
        -:   64:\*====================================================================================================================*/
        -:   65:
        -:   66:
        3:   67:void Test_Of_CanTp_Init(void){
        -:   68:	//TEST1
        3:   69:    CanTp_ConfigType config = {
        -:   70:        .CanTpMainFunctionPeriod = 0.01,
        -:   71:        .CanTpMaxChannelCnt = 1,
        -:   72:        .pChannel = 0
        -:   73:    };
        -:   74:
        3:   75:    CanTpInit(&config);
        -:   76:    
        3:   77:    TEST_CHECK(CanTpState == CANTP_ON);
        -:   78:	//TEST2
        3:   79:	CanTpInit(NULL);
        3:   80:    TEST_CHECK(CanTpState == CANTP_ON);  // Stan siÄ™ nie zmienia
        3:   81:}
        -:   82:
        -:   83:
        3:   84:void Test_Of_CanTp_GetVersionInfo(void)
        -:   85:{
        -:   86:    Std_VersionInfoType versionInfo;
        -:   87:
        -:   88:    // TEST1
        3:   89:    CanTp_GetVersionInfo(&versionInfo);
        -:   90:
        3:   91:    TEST_CHECK(versionInfo.vendorID == 0x00u);
        3:   92:    TEST_CHECK(versionInfo.moduleID == CANTP_MODULE_ID);
        3:   93:    TEST_CHECK(versionInfo.sw_major_version == CANTP_SW_MAJOR_VERSION);
        3:   94:    TEST_CHECK(versionInfo.sw_minor_version == CANTP_SW_MINOR_VERSION);
        3:   95:    TEST_CHECK(versionInfo.sw_patch_version == CANTP_SW_PATCH_VERSION);
        -:   96:
        -:   97:    // TEST2
        3:   98:    CanTp_GetVersionInfo(NULL);
        -:   99:      
        3:  100:}
        -:  101:
        -:  102:
        3:  103:void Test_Of_CanTp_Shutdown(void){
        -:  104:
        3:  105:    CanTpState = CANTP_ON;
        -:  106:
        3:  107:    CanTp_Shutdown();
        -:  108:
        3:  109:    TEST_CHECK(CanTpState == CANTP_OFF);
        3:  110:    TEST_CHECK(CanTpState != CANTP_ON);
        -:  111:	
        -:  112:	//TEST2
        3:  113:	  CanTp_Shutdown();
        3:  114:    TEST_CHECK(CanTpState == CANTP_OFF);
        3:  115:}
        -:  116:
        -:  117:
        3:  118:void TestOf_CanTp_Transmit(void){
        -:  119:
        3:  120:    PduIdType txPduId = 0x01;
        3:  121:    uint8 sduData[8] = {0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88};
        3:  122:    uint8 metaData[3] = {0x11, 0x22, 0x33};
        -:  123:
        3:  124:    PduInfoType pduInfo = {
        -:  125:        .SduDataPtr = sduData,
        -:  126:        .SduLength = 6,
        -:  127:        .MetaDataPtr = metaData
        -:  128:    };
        -:  129:
        3:  130:    RESET_FAKE(PduR_CanTpCopyTxData);
        3:  131:    RESET_FAKE(CanTp_SendSF);
        3:  132:    RESET_FAKE(PduR_CanTpTxConfirmation);
        3:  133:    RESET_FAKE(CanTp_SendFF);
        -:  134:
        3:  135:    BufReq_ReturnType retPduR_CanTpCopyTxData[7] = {BUFREQ_OK, BUFREQ_E_NOT_OK, BUFREQ_E_OVFL, E_OK, E_NOT_OK, E_NOT_OK, E_NOT_OK};
        3:  136:    SET_RETURN_SEQ(PduR_CanTpCopyTxData, retPduR_CanTpCopyTxData, 7);
        -:  137:
        3:  138:    Std_ReturnType retCanTp_SendSF[7] = {E_OK, E_OK, E_NOT_OK, E_OK, E_NOT_OK, E_NOT_OK, E_NOT_OK};
        3:  139:    SET_RETURN_SEQ(CanTp_SendSF, retCanTp_SendSF, 7);
        3:  140:    Std_ReturnType retCanTp_SendFF[7] = {E_OK, E_NOT_OK, E_NOT_OK, E_OK, E_NOT_OK, E_NOT_OK, E_NOT_OK};
        3:  141:    SET_RETURN_SEQ(CanTp_SendFF, retCanTp_SendFF, 7);
        -:  142:
        -:  143:    // TEST1: 
        3:  144:    CanTpState = CANTP_OFF;
        3:  145:    Std_ReturnType ret = CanTp_Transmit(txPduId, &pduInfo);
        3:  146:    TEST_CHECK(ret == E_NOT_OK);
        -:  147:
        -:  148:
        -:  149:
        -:  150:    // TEST2:
        -:  151:
        3:  152:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_EXTENDED;
        3:  153:    CanTpState = CANTP_ON;
        3:  154:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        3:  155:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  156:
        3:  157:    TEST_CHECK(ret == E_OK);
        3:  158:    TEST_CHECK(p_n_sdu.tx.taskState == CANTP_TX_WAIT);
        3:  159:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        3:  160:    TEST_CHECK(p_n_sdu.tx.saved_n_ta.CanTpNTa == 0x11);
        -:  161:
        3:  162:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 1);
        3:  163:    TEST_CHECK(CanTp_SendSF_fake.call_count == 1);
        -:  164:
        -:  165:  //TEST3
        -:  166:
        3:  167:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED;
        3:  168:    CanTpState = CANTP_ON;
        3:  169:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        3:  170:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  171:
        3:  172:    TEST_CHECK(ret == E_NOT_OK);
        3:  173:    TEST_CHECK(CanTp_ConfigPtr.pChannel.tx.CanTpTX_state == CANTP_TX_WAIT);
        3:  174:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        3:  175:    TEST_CHECK(p_n_sdu.tx.saved_n_ae.CanTpNAe == 0x11);
        3:  176:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 2);
        -:  177:
        3:  178:    TEST_CHECK(PduR_CanTpTxConfirmation_fake.call_count == 1);
        3:  179:    TEST_CHECK(CanTp_SendSF_fake.call_count == 1);
        -:  180:
        -:  181:  //TEST4
        -:  182:
        3:  183:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_NORMALFIXED;
        3:  184:    CanTpState = CANTP_ON;
        3:  185:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        3:  186:    pduInfo.SduLength = 8;
        3:  187:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  188:
        3:  189:    TEST_CHECK(ret == E_OK);
        3:  190:    TEST_CHECK(CanTp_ConfigPtr.pChannel.tx.CanTpTX_state == CANTP_TX_WAIT);
        3:  191:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        3:  192:    TEST_CHECK(p_n_sdu.tx.saved_n_sa.CanTpNSa == 0x11);
        3:  193:    TEST_CHECK(p_n_sdu.tx.saved_n_ta.CanTpNTa == 0x22);
        -:  194:
        3:  195:    TEST_CHECK(CanTp_SendFF_fake.call_count == 1);
        -:  196:	
        -:  197:    //TEST5
        -:  198:
        3:  199:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED29BIT;
        3:  200:    CanTpState = CANTP_ON;
        3:  201:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        3:  202:    pduInfo.SduLength = 8;
        3:  203:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  204:
        3:  205:    TEST_CHECK(ret == E_NOT_OK);
        3:  206:    TEST_CHECK(CanTp_ConfigPtr.pChannel.tx.CanTpTX_state == CANTP_TX_WAIT);
        3:  207:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        3:  208:    TEST_CHECK(p_n_sdu.tx.saved_n_sa.CanTpNSa == 0x11);
        3:  209:    TEST_CHECK(p_n_sdu.tx.saved_n_ta.CanTpNTa == 0x22);
        3:  210:    TEST_CHECK(p_n_sdu.tx.saved_n_ae.CanTpNAe == 0x33);
        -:  211:
        3:  212:    TEST_CHECK(CanTp_SendFF_fake.call_count == 2);
        -:  213:
        -:  214:    //TEST6
        -:  215:
        3:  216:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED29BIT;
        3:  217:    CanTpState = CANTP_ON;
        3:  218:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        3:  219:    pduInfo.SduLength = 3;
        3:  220:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  221:
        3:  222:    TEST_CHECK(ret == E_OK);
        3:  223:    TEST_CHECK(p_n_sdu.tx.has_meta_data == TRUE);
        3:  224:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 3);
        -:  225:
        -:  226:
        -:  227:    //TEST7
        -:  228:
        3:  229:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED29BIT;
        3:  230:    CanTpState = CANTP_ON;
        3:  231:    p_n_sdu.tx.taskState = CANTP_TX_WAIT;
        3:  232:    pduInfo.MetaDataPtr = NULL;
        3:  233:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  234:
        3:  235:    TEST_CHECK(ret == E_OK);
        3:  236:    TEST_CHECK(p_n_sdu.tx.has_meta_data == FALSE);
        3:  237:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 4);
        -:  238:
        -:  239:     //TEST7
        -:  240:
        3:  241:    p_n_sdu.tx.cfg.CanTpTxAddressingFormat = CANTP_MIXED29BIT;
        3:  242:    CanTpState = CANTP_ON;
        3:  243:    p_n_sdu.tx.taskState = CANTP_TX_PROCESSING;
        3:  244:    pduInfo.MetaDataPtr = NULL;
        3:  245:    ret = CanTp_Transmit(txPduId, &pduInfo);
        -:  246:
        3:  247:    TEST_CHECK(ret == E_NOT_OK);
        3:  248:    TEST_CHECK(p_n_sdu.tx.has_meta_data == FALSE);
        3:  249:    TEST_CHECK(PduR_CanTpCopyTxData_fake.call_count == 4);
        -:  250:
        -:  251:
        -:  252:  
        3:  253:}
        -:  254:
        -:  255:
        3:  256:void Test_Of_CanTp_CancelTransmit(void){
        -:  257:
        3:  258:    PduIdType txPduId = 1;
        -:  259:
        3:  260:    CanTp_ConfigPtr.pChannel.tx.CanTpTxNSduId = 2;
        -:  261:
        3:  262:    Std_ReturnType ret = CanTp_CancelTransmit(txPduId);
        3:  263:    TEST_CHECK(ret == E_NOT_OK);
        -:  264:
        3:  265:    CanTp_ConfigPtr.pChannel.tx.CanTpTxNSduId = txPduId;
        3:  266:    ret = CanTp_CancelTransmit(txPduId);
        3:  267:    TEST_CHECK(ret == E_OK);
        -:  268:
        3:  269:}
        -:  270:
        -:  271:
        3:  272:void Test_Of_CanTp_CancelReceive(void){
        3:  273:    PduIdType rxPduId = 0x01;
        -:  274:
        3:  275:    CanTp_ConfigPtr.pChannel.rx.CanTpRxNSduId = 2;
        -:  276:
        3:  277:    Std_ReturnType ret = CanTp_CancelReceive(rxPduId);
        3:  278:    TEST_CHECK(ret == E_NOT_OK);
        -:  279:
        3:  280:    CanTp_ConfigPtr.pChannel.rx.CanTpRxNSduId = rxPduId;
        3:  281:    ret = CanTp_CancelReceive(rxPduId);
        3:  282:    TEST_CHECK(ret == E_OK);
        3:  283:}
        -:  284:
        -:  285:
        -:  286:
        3:  287:void Test_Of_CanTp_ChangeParameter(void){
        3:  288:    PduIdType id = 0x01;
        3:  289:    CanTpGeneralgPtr.CanTpChangeParameterApi = 1; 
        -:  290:
        3:  291:    CanTpState = CANTP_ON;
        3:  292:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_WAIT;
        3:  293:    TPParameterType Parameter_Test = TP_BS;
        3:  294:    uint16 value = 10;
        -:  295:
        3:  296:    Std_ReturnType ret = CanTp_ChangeParameter(id, Parameter_Test, value);
        3:  297:    TEST_CHECK(ret == E_OK);
        3:  298:    TEST_CHECK(p_n_sdu.rx.shared_params.params.bs == 10);
        -:  299:
        3:  300:    ret = CanTp_ChangeParameter(id, TP_STMIN, 20);
        3:  301:    TEST_CHECK(ret == E_OK);
        3:  302:    TEST_CHECK(p_n_sdu.rx.shared_params.params.st_min == 20);
        -:  303:
        3:  304:    ret = CanTp_ChangeParameter(id, TP_BC, 30);
        3:  305:    TEST_CHECK(ret == E_NOT_OK);
        -:  306:
        3:  307:    CanTpState = CANTP_OFF;
        3:  308:    ret = CanTp_ChangeParameter(id, TP_BS, 40);
        3:  309:    TEST_CHECK(ret == E_NOT_OK);
        -:  310:
        3:  311:    CanTpState = CANTP_ON;
        3:  312:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_PROCESSING; 
        3:  313:    ret = CanTp_ChangeParameter(id, TP_BS, 40);
        3:  314:    TEST_CHECK(ret == E_NOT_OK);
        -:  315:
        3:  316:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_WAIT; 
        3:  317:    CanTpState = CANTP_ON;
        3:  318:    CanTpGeneralgPtr.CanTpChangeParameterApi = 0; 
        3:  319:    ret = CanTp_ChangeParameter(id, TP_BS, 40);
        3:  320:    TEST_CHECK(ret == E_NOT_OK);
        -:  321:
        -:  322:    
        3:  323:}
        -:  324:
        -:  325:
        3:  326:void Test_Of_CanTp_ReadParameter(void){
        3:  327:    PduIdType id = 1;
        -:  328:    uint16 value;
        -:  329:
        3:  330:    CanTpState = CANTP_ON;
        3:  331:    p_n_sdu.rx.shared_params.params.bs = 15;
        3:  332:    CanTpGeneralgPtr.CanTpReadParameterApi  = 1;
        -:  333:
        3:  334:    Std_ReturnType ret = CanTp_ReadParameter(id, TP_BS, &value);
        3:  335:    TEST_CHECK(ret == E_OK);
        3:  336:    TEST_CHECK(value == 15);
        -:  337:
        -:  338:    
        3:  339:    p_n_sdu.rx.shared_params.params.st_min = 25;
        3:  340:    ret = CanTp_ReadParameter(id, TP_STMIN, &value);
        3:  341:    TEST_CHECK(ret == E_OK);
        3:  342:    TEST_CHECK(value == 25);
        -:  343:
        3:  344:    ret = CanTp_ReadParameter(id, TP_BC, &value);
        3:  345:    TEST_CHECK(ret == E_NOT_OK);
        -:  346:
        3:  347:    CanTpState = CANTP_OFF;
        3:  348:    ret = CanTp_ReadParameter(id, TP_BS, &value);
        3:  349:    TEST_CHECK(ret == E_NOT_OK);
        -:  350:
        3:  351:    CanTpState = CANTP_ON;
        3:  352:    CanTpGeneralgPtr.CanTpReadParameterApi  = 0; 
        3:  353:    ret = CanTp_ReadParameter(id, TP_BS, &value);
        3:  354:    TEST_CHECK(ret == E_NOT_OK);
        3:  355:}
        -:  356:
        3:  357:void Test_Of_CanTp_MainFunction(){
        -:  358:
        3:  359:    RESET_FAKE(PduR_CanTpRxIndication);
        3:  360:    RESET_FAKE(PduR_CanTpTxConfirmation);
        -:  361:
        -:  362:
        3:  363:    CanTp_TimerReset(&N_Ar_timer);
        3:  364:    CanTp_MainFunction();
        3:  365:    TEST_CHECK(N_Ar_timer.uiCounter == 0);
        -:  366:
        3:  367:    CanTp_TimerStart(&N_Ar_timer);
        3:  368:    CanTp_MainFunction();
        3:  369:    TEST_CHECK(N_Ar_timer.uiCounter == 1);
        -:  370:
        3:  371:    N_Ar_timer.uiCounter = 999;
        3:  372:    CanTp_MainFunction();
        3:  373:    TEST_CHECK(N_Ar_timer.uiCounter == 0);
        -:  374:
        3:  375:    N_As_timer.uiCounter = 990;
        3:  376:    CanTp_TimerStart(&N_As_timer);
        3:  377:    CanTp_MainFunction();
        -:  378:
        3:  379:    TEST_CHECK(N_As_timer.uiCounter == 991);
        3:  380:    TEST_CHECK(N_As_timer.eState == TIMER_ENABLE);
        3:  381:    TEST_CHECK(N_Bs_timer.uiCounter == 0);
        3:  382:    TEST_CHECK(N_Bs_timer.eState == TIMER_DISABLE);
        3:  383:    TEST_CHECK(N_Cs_timer.uiCounter == 0);
        3:  384:    TEST_CHECK(N_Cs_timer.eState == TIMER_DISABLE);
        -:  385:
        3:  386:    TEST_CHECK(PduR_CanTpTxConfirmation_fake.call_count == 0);
        -:  387:    
        -:  388:
        3:  389:    CanTp_TimerStart(&N_As_timer);
        3:  390:    CanTp_TimerStart(&N_Bs_timer);
        3:  391:    CanTp_TimerStart(&N_Cs_timer);
        -:  392:
        3:  393:    CanTp_TimerStart(&N_Ar_timer);
        3:  394:    CanTp_TimerStart(&N_Br_timer);
        3:  395:    CanTp_TimerStart(&N_Cr_timer);
        -:  396:
        3:  397:    N_As_timer.uiCounter = 999;
        3:  398:    N_Bs_timer.uiCounter = 999;
        3:  399:    N_Cs_timer.uiCounter = 999;
        3:  400:    N_Ar_timer.uiCounter = 999;
        3:  401:    N_Br_timer.uiCounter = 999;
        3:  402:    N_Cr_timer.uiCounter = 999;
        3:  403:    RESET_FAKE(PduR_CanTpTxConfirmation);
        3:  404:    RESET_FAKE(PduR_CanTpRxIndication);
        3:  405:    CanTp_MainFunction();
        -:  406:  
        3:  407:    TEST_CHECK(N_As_timer.uiCounter == 0);
        3:  408:    TEST_CHECK(N_As_timer.eState == TIMER_DISABLE);
        3:  409:    TEST_CHECK(N_Bs_timer.uiCounter == 0);
        3:  410:    TEST_CHECK(N_Bs_timer.eState == TIMER_DISABLE);
        3:  411:    TEST_CHECK(N_Cs_timer.uiCounter == 0);
        3:  412:    TEST_CHECK(N_Cs_timer.eState == TIMER_DISABLE);
        -:  413:
        3:  414:    TEST_CHECK(N_Ar_timer.uiCounter == 0);
        3:  415:    TEST_CHECK(N_Ar_timer.eState == TIMER_DISABLE);
        3:  416:    TEST_CHECK(N_Br_timer.uiCounter == 0);
        3:  417:    TEST_CHECK(N_Br_timer.eState == TIMER_DISABLE);
        3:  418:    TEST_CHECK(N_Cr_timer.uiCounter == 0);
        3:  419:    TEST_CHECK(N_Cr_timer.eState == TIMER_DISABLE);
        -:  420:
        3:  421:    TEST_CHECK(PduR_CanTpTxConfirmation_fake.call_count == 3);
        3:  422:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 3);
        -:  423:
        3:  424:}
        -:  425:
        -:  426:
        3:  427:void Test_CanTp_RxIndication(void) {
        3:  428:    PduIdType rxPduId = 1;
        3:  429:    CanTpState = CANTP_ON;
        -:  430:
        -:  431:    PduInfoType testPduInfo;
        3:  432:    uint8 testSduData[8] = {SF<<4, 0, 0, 0, 0, 0, 0, 0};
        3:  433:    testPduInfo.SduDataPtr = testSduData;
        -:  434:
        3:  435:    RESET_FAKE(CanTp_FFReception);
        3:  436:    RESET_FAKE(CanTp_SFReception);
        3:  437:    RESET_FAKE(CanTp_FCReception);
        3:  438:    RESET_FAKE(CanTp_CFReception);
        3:  439:    RESET_FAKE(PduR_CanTpRxIndication);
        -:  440:
        -:  441:   
        3:  442:    CanTpState = CANTP_ON;
        3:  443:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_WAIT;
        -:  444:
        3:  445:    CanTp_RxIndication(rxPduId, &testPduInfo);
        3:  446:    TEST_CHECK(CanTp_SFReception_fake.call_count == 1);
        -:  447:
        3:  448:    testSduData[0] = FF<<4;
        3:  449:    testPduInfo.SduDataPtr = testSduData;
        -:  450:
        3:  451:    CanTp_RxIndication(rxPduId, &testPduInfo);
        3:  452:    TEST_CHECK(CanTp_FFReception_fake.call_count == 1);
        -:  453:
        3:  454:    testSduData[0] = FC<<4;
        3:  455:    testPduInfo.SduDataPtr = testSduData;
        -:  456:
        3:  457:    CanTp_RxIndication(rxPduId, &testPduInfo);
        3:  458:    TEST_CHECK(CanTp_FCReception_fake.call_count == 1);
        -:  459:
        3:  460:    testSduData[0] = CF<<4;
        3:  461:    testPduInfo.SduDataPtr = testSduData;
        -:  462:
        3:  463:    CanTp_RxIndication(rxPduId, &testPduInfo);
        3:  464:    TEST_CHECK(CanTp_SFReception_fake.call_count == 1);
        3:  465:    TEST_CHECK(CanTp_FFReception_fake.call_count == 1);
        3:  466:    TEST_CHECK(CanTp_FCReception_fake.call_count == 1);
        -:  467:
        3:  468:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_PROCESSING;
        -:  469:
        3:  470:    testSduData[0] = CF<<4;
        3:  471:    testPduInfo.SduDataPtr = testSduData;
        -:  472:
        3:  473:    CanTp_RxIndication(rxPduId, &testPduInfo);
        3:  474:    TEST_CHECK(CanTp_CFReception_fake.call_count == 1);
        -:  475:
        3:  476:    testSduData[0] = FC<<4;
        3:  477:    testPduInfo.SduDataPtr = testSduData;
        -:  478:
        3:  479:    CanTp_RxIndication(rxPduId, &testPduInfo);
        3:  480:    TEST_CHECK(CanTp_FCReception_fake.call_count == 2);
        -:  481:
        3:  482:    testSduData[0] = FF<<4;
        3:  483:    testPduInfo.SduDataPtr = testSduData;
        -:  484:
        3:  485:    CanTp_RxIndication(rxPduId, &testPduInfo);
        3:  486:    TEST_CHECK(CanTp_FFReception_fake.call_count == 2);
        3:  487:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 1);
        3:  488:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        -:  489:
        3:  490:    p_n_sdu.rx.shared_params.taskState = CANTP_RX_PROCESSING;
        -:  491:
        3:  492:    testSduData[0] = SF<<4;
        3:  493:    testPduInfo.SduDataPtr = testSduData;
        -:  494:
        3:  495:    CanTp_RxIndication(rxPduId, &testPduInfo);
        3:  496:    TEST_CHECK(CanTp_SFReception_fake.call_count == 2);
        3:  497:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 2);
        3:  498:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        -:  499:
        3:  500:}
        -:  501:
        -:  502:
        3:  503:void Test_Of_CanTp_TxConfirmation(void){
        -:  504:
        3:  505:  RESET_FAKE(PduR_CanTpCopyTxData);
        3:  506:  RESET_FAKE(CanTp_SendNextCF);
        3:  507:  RESET_FAKE(PduR_CanTpTxConfirmation);
        3:  508:  RESET_FAKE(PduR_CanTpRxIndication);
        -:  509:
        -:  510:    
        3:  511:    CanTpState = CANTP_ON;
        3:  512:    CanTp_ConfigPtr.pChannel.rx.CanTpRxNSduId = 2;
        3:  513:    CanTp_ConfigPtr.pChannel.rx.CanTpRX_state = CANTP_RX_PROCESSING;
        3:  514:    CanTp_ConfigPtr.pChannel.tx.CanTpTxNSduId = 1;
        3:  515:    CanTp_ConfigPtr.pChannel.tx.CanTpTX_state = CANTP_TX_PROCESSING;
        -:  516:
        3:  517:    CanTp_TxConfirmation(2, E_NOT_OK);
        3:  518:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        3:  519:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 1 );
        -:  520:
        -:  521:    
        3:  522:    CanTp_TxConfirmation(2, E_OK);
        3:  523:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        3:  524:    TEST_CHECK(PduR_CanTpRxIndication_fake.call_count == 1 );
        -:  525:
        3:  526:    CanTp_TxConfirmation(1, E_OK);
        3:  527:    TEST_CHECK(CanTp_SendNextCF_fake.call_count == 1 );
        -:  528:
        3:  529:    CanTp_TxConfirmation(1, E_NOT_OK);
        3:  530:    TEST_CHECK(CanTp_ConfigPtr.pChannel.rx.CanTpRX_state == CANTP_RX_WAIT);
        3:  531:    TEST_CHECK(PduR_CanTpTxConfirmation_fake.call_count == 1);
        -:  532:
        -:  533:
        3:  534:}
        -:  535:
        -:  536:/** ==================================================================================================================*\
        -:  537:                                TESTY FUNKCJI POMOCNICZYCH
        -:  538:\*====================================================================================================================*/
        -:  539:
        3:  540:void Test_CanTp_TimerStart(void) {
        3:  541:    CanTp_Timer_type timer = {TIMER_DISABLE, 0, 100};
        -:  542:
        3:  543:    CanTp_TimerStart(&timer);
        3:  544:    TEST_CHECK(timer.eState == TIMER_ENABLE);
        3:  545:    TEST_CHECK(timer.uiCounter == 0);
        -:  546:
        3:  547:    timer.eState = TIMER_ENABLE;
        3:  548:    CanTp_TimerStart(&timer);
        3:  549:    TEST_CHECK(timer.eState == TIMER_ENABLE);
        3:  550:    TEST_CHECK(timer.uiCounter == 0);
        3:  551:}
        -:  552:
        3:  553:void Test_Of_TimerReset(void){     
        3:  554:    CanTp_Timer_type timer = {TIMER_ENABLE, 50, 100};
        -:  555:
        3:  556:    CanTp_TimerReset(&timer);
        3:  557:    TEST_CHECK(timer.eState == TIMER_DISABLE);
        3:  558:    TEST_CHECK(timer.uiCounter == 0);
        -:  559:
        3:  560:    CanTp_TimerReset(&timer);
        3:  561:    TEST_CHECK(timer.eState == TIMER_DISABLE);
        3:  562:    TEST_CHECK(timer.uiCounter == 0);
        3:  563:}
        -:  564:
        -:  565:
        3:  566:void Test_CanTp_TimerTick(void) {
        3:  567:    CanTp_Timer_type timer = {TIMER_ENABLE, 0, 100};
        -:  568:
        3:  569:    Std_ReturnType ret = CanTp_TimerTick(&timer);
        3:  570:    TEST_CHECK(ret == E_OK);
        3:  571:    TEST_CHECK(timer.uiCounter == 1);
        -:  572:
        3:  573:    timer.uiCounter = UINT32_MAX;
        3:  574:    ret = CanTp_TimerTick(&timer);
        3:  575:    TEST_CHECK(ret == E_NOT_OK);
        3:  576:    TEST_CHECK(timer.uiCounter == UINT32_MAX);
        -:  577:
        3:  578:    timer.eState = TIMER_DISABLE;
        3:  579:    ret = CanTp_TimerTick(&timer);
        3:  580:    TEST_CHECK(ret == E_OK);
        3:  581:    TEST_CHECK(timer.uiCounter == UINT32_MAX);  
        3:  582:}
        -:  583:
        3:  584:void Test_CanTp_TimerTimeout(void) {
        3:  585:    CanTp_Timer_type timer = {TIMER_ENABLE, 100, 100};
        -:  586:
        3:  587:    Std_ReturnType ret = CanTp_TimerTimeout(&timer);
        3:  588:    TEST_CHECK(ret == E_NOT_OK);
        -:  589:
        3:  590:    timer.uiCounter = 50;
        3:  591:    ret = CanTp_TimerTimeout(&timer);
        3:  592:    TEST_CHECK(ret == E_OK);
        3:  593:}
        -:  594:
        -:  595:
        -:  596:TEST_LIST = {
        -:  597:    { "Test of CanTp_MainFunction", Test_Of_CanTp_MainFunction },
        -:  598:    { "Test of CanTp_ReadParameter", Test_Of_CanTp_ReadParameter },
        -:  599:    { "Test of CanTp_ChangeParameter", Test_Of_CanTp_ChangeParameter },
        -:  600:	  { "Test of CanTp_TimerStart", Test_CanTp_TimerStart },
        -:  601:    { "Test of CanTp_TimerReset", Test_Of_TimerReset },
        -:  602:    { "Test of CanTp_TimerTick", Test_CanTp_TimerTick },
        -:  603:    { "Test of CanTp_TimerTimeout", Test_CanTp_TimerTimeout },
        -:  604:    { "Test of CanTp_RxIndication", Test_CanTp_RxIndication },
        -:  605:    { "Test of CanTp_TxConfirmation", Test_Of_CanTp_TxConfirmation },
        -:  606:    { "Test of CanTp_CancelReceive", Test_Of_CanTp_CancelReceive },
        -:  607:    { "Test of CanTp_CancelTransmit", Test_Of_CanTp_CancelTransmit },
        -:  608:    { "Test of CanTp_Transmit", TestOf_CanTp_Transmit },
        -:  609:    { "Test of CanTp_Init", Test_Of_CanTp_Init },
        -:  610:    { "Test of CanTp_Shutdown", Test_Of_CanTp_Shutdown },
        -:  611:	{ "Test of CanTp_GetVersionInfo", Test_Of_CanTp_GetVersionInfo },
        -:  612:    { NULL, NULL }                           
        -:  613:};
